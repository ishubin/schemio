{"name": "Line chart", "description": "", "args": {"cornerRadius": {"type": "number", "value": 10, "name": "Corner radius", "min": 0}, "lineType": {"type": "choice", "value": "smooth", "options": ["linear", "smooth"], "name": "Connectors Type"}, "xMin": {"type": "number", "value": 0, "name": "X min"}, "xMax": {"type": "number", "value": 100, "name": "X max"}, "xStep": {"type": "number", "value": 10, "name": "X step"}, "yMin": {"type": "number", "value": 0, "name": "Y min"}, "yMax": {"type": "number", "value": 100, "name": "Y max"}, "datasets": {"name": "Datasets", "singular": "graph", "type": "array", "value": [{"id": "24tUTkZnn", "name": "Data 1", "values": "20, 40, 30, 50", "color": "#355E97FF"}], "args": {"name": {"type": "string", "value": "Data ##IDX##", "name": "Name"}, "values": {"type": "string", "value": "20, 40, 25, 45", "name": "Values"}, "color": {"type": "color", "value": "#355E97FF", "name": "Color"}}}}, "preview": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhodG1sPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmlld0JveD0iLTEwIC0xMCAzNDAgMjIwIj48ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMCwwKSByb3RhdGUoMCkiIGRhdGEtc3ZnLWl0ZW0tY29udGFpbmVyLWlkPSJaZ2txU09HSVkiIGRhdGEtaXRlbS1pZD0iWmdrcVNPR0lZIj4gIDxnIHN0eWxlPSJvcGFjaXR5OiAxOyBtaXgtYmxlbmQtbW9kZTogbm9ybWFsOyI+IDxkZWZzLz4gPGcgZmlsdGVyPSIiPiA8ZyBzdHlsZT0ib3BhY2l0eTogMTsiPjxnPjxnPjxnPiA8L2c+IDxwYXRoIGQ9Ik0gMTAwIDYwICBMIDIwIDYwIGEgMjAgMjAgMCAwIDEgLTIwIC0yMCAgTCAwIDIwICBhIDIwIDIwIDAgMCAxIDIwIC0yMCAgIEwgMTAwIDAgICBhIDIwIDIwIDAgMCAxIDIwIDIwICBMIDEyMCA0MCAgIGEgMjAgMjAgMCAwIDEgLTIwIDIwIFoiIHN0cm9rZS13aWR0aD0iMnB4IiBzdHJva2U9InJnYmEoMzAsMzAsMzAsMS4wKSIgc3Ryb2tlLWRhc2hhcnJheT0iIiBzdHJva2UtZGFzaG9mZnNldD0iMCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0icmdiYSgyNDAsMjQwLDI0MCwxLjApIi8+PC9nPjwvZz48L2c+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsiLz48L2c+ICA8ZyBpZD0iYW5pbWF0aW9uLWNvbnRhaW5lci1aZ2txU09HSVkiLz4gICAgICAgPC9nPjwvZz4KPGcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDE0MCkgcm90YXRlKDApIiBkYXRhLXN2Zy1pdGVtLWNvbnRhaW5lci1pZD0iaDdSV0p0UTBLIiBkYXRhLWl0ZW0taWQ9Img3UldKdFEwSyI+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsgbWl4LWJsZW5kLW1vZGU6IG5vcm1hbDsiPiA8ZGVmcy8+IDxnIGZpbHRlcj0iIj4gPGcgc3R5bGU9Im9wYWNpdHk6IDE7Ij48Zz48Zz48Zz4gPC9nPiA8cGF0aCBkPSJNIDEwMCA2MCAgTCAyMCA2MCBhIDIwIDIwIDAgMCAxIC0yMCAtMjAgIEwgMCAyMCAgYSAyMCAyMCAwIDAgMSAyMCAtMjAgICBMIDEwMCAwICAgYSAyMCAyMCAwIDAgMSAyMCAyMCAgTCAxMjAgNDAgICBhIDIwIDIwIDAgMCAxIC0yMCAyMCBaIiBzdHJva2Utd2lkdGg9IjJweCIgc3Ryb2tlPSJyZ2JhKDMwLDMwLDMwLDEuMCkiIHN0cm9rZS1kYXNoYXJyYXk9IiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjAiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGZpbGw9InJnYmEoMjQwLDI0MCwyNDAsMS4wKSIvPjwvZz48L2c+PC9nPiAgPGcgc3R5bGU9Im9wYWNpdHk6IDE7Ii8+PC9nPiAgPGcgaWQ9ImFuaW1hdGlvbi1jb250YWluZXItaDdSV0p0UTBLIi8+ICAgICAgIDwvZz48L2c+CjxnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjAsNjApIHJvdGF0ZSgwKSIgZGF0YS1zdmctaXRlbS1jb250YWluZXItaWQ9ImRwUXQ3Tlk4dyIgZGF0YS1pdGVtLWlkPSJkcFF0N05ZOHciPiAgPGcgc3R5bGU9Im9wYWNpdHk6IDE7IG1peC1ibGVuZC1tb2RlOiBub3JtYWw7Ij4gPGRlZnMvPiA8ZyBmaWx0ZXI9IiI+PGcgbW9kZT0iZWRpdCIgc3R5bGU9Im9wYWNpdHk6IDE7Ij48Zz4gPC9nPiA8cGF0aCBkPSJNIDEwMCAwIEMgMTAwIDM4Ljg3IDAgIDIxLjEzIDAgNjAgIiBzdHJva2Utd2lkdGg9IjJweCIgc3Ryb2tlPSJyZ2JhKDMwLDMwLDMwLDEuMCkiIHN0cm9rZS1kYXNoYXJyYXk9IiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2UtbGluZWpvaW46IHJvdW5kOyIvPiA8Zz48cGF0aCBkPSJNIC01IDYwIEwgMCA4MCBMIDUgNjAgIHogIiBzdHJva2U9InJnYmEoMzAsMzAsMzAsMS4wKSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJyZ2JhKDMwLDMwLDMwLDEuMCkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9nPiAgIDwvZz4gIDxnIGlkPSJhbmltYXRpb24tY29udGFpbmVyLWRwUXQ3Tlk4dyIvPiAgICAgICA8L2c+PC9nPgo8ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwMCwxNDApIHJvdGF0ZSgwKSIgZGF0YS1zdmctaXRlbS1jb250YWluZXItaWQ9Ik1Nanh4QXptVzQiIGRhdGEtaXRlbS1pZD0iTU1qeHhBem1XNCI+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsgbWl4LWJsZW5kLW1vZGU6IG5vcm1hbDsiPiA8ZGVmcy8+IDxnIGZpbHRlcj0iIj4gPGcgc3R5bGU9Im9wYWNpdHk6IDE7Ij48Zz48Zz48Zz4gPC9nPiA8cGF0aCBkPSJNIDEwMCA2MCAgTCAyMCA2MCBhIDIwIDIwIDAgMCAxIC0yMCAtMjAgIEwgMCAyMCAgYSAyMCAyMCAwIDAgMSAyMCAtMjAgICBMIDEwMCAwICAgYSAyMCAyMCAwIDAgMSAyMCAyMCAgTCAxMjAgNDAgICBhIDIwIDIwIDAgMCAxIC0yMCAyMCBaIiBzdHJva2Utd2lkdGg9IjJweCIgc3Ryb2tlPSJyZ2JhKDMwLDMwLDMwLDEuMCkiIHN0cm9rZS1kYXNoYXJyYXk9IiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0icmdiYSgyNDAsMjQwLDI0MCwxLjApIi8+PC9nPjwvZz48L2c+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsiLz48L2c+ICA8ZyBpZD0iYW5pbWF0aW9uLWNvbnRhaW5lci1NTWp4eEF6bVc0Ii8+ICAgICAgIDwvZz48L2c+CjxnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTYwLDYwKSByb3RhdGUoMCkiIGRhdGEtc3ZnLWl0ZW0tY29udGFpbmVyLWlkPSJSSkhNU2FYUTYiIGRhdGEtaXRlbS1pZD0iUkpITVNhWFE2Ij4gIDxnIHN0eWxlPSJvcGFjaXR5OiAxOyBtaXgtYmxlbmQtbW9kZTogbm9ybWFsOyI+IDxkZWZzLz4gPGcgZmlsdGVyPSIiPjxnIG1vZGU9ImVkaXQiIHN0eWxlPSJvcGFjaXR5OiAxOyI+PGc+IDwvZz4gPHBhdGggZD0iTSAwIDAgQyAwIDM4Ljg3IDEwMCAgMjEuMTMgMTAwIDYwICIgc3Ryb2tlLXdpZHRoPSIycHgiIHN0cm9rZT0icmdiYSgzMCwzMCwzMCwxLjApIiBzdHJva2UtZGFzaGFycmF5PSIiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlLWxpbmVqb2luOiByb3VuZDsiLz4gPGc+PHBhdGggZD0iTSA5NSA2MCBMIDEwMCA4MCBMIDEwNSA2MCAgeiAiIHN0cm9rZT0icmdiYSgzMCwzMCwzMCwxLjApIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9InJnYmEoMzAsMzAsMzAsMS4wKSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L2c+ICAgPC9nPiAgPGcgaWQ9ImFuaW1hdGlvbi1jb250YWluZXItUkpITVNhWFE2Ii8+ICAgICAgIDwvZz48L2c+PC9zdmc+", "defaultArea": {"x": 0, "y": 0, "w": 120, "h": 60}, "import": ["./src/line-chart.sch"], "$-def:changeDataPointInitScript": {"$-str": "struct Point {\n  x: 0\n  y: 0\n  x1: 0\n  y1: 0\n  x2: 0\n  y2: 0\n}\n\nlocal xStep = ${xStep}\nlocal xMax = ${xMax}\nlocal xMin = ${xMin}\nlocal yMax = ${yMax}\nlocal yMin = ${yMin}\nlocal lineType = \"${lineType}\"\n\nlocal pathItem = findChildItemsByTag('dataset-path').find((item) => {item.getName() == name})\nif (pathItem.getShape() != 'path') {\n  return\n}\nlocal plot = pathItem.findParent()\nlocal plotWidth = plot.getWidth()\nlocal plotHeight = plot.getHeight()\nlocal dy = yMax - yMin\nlocal dx = plotWidth * xStep / max(0.000001, xMax - xMin)\n\nlocal values = data.split(',').map(parseInt)\nif (pathItem.totalPaths() == 0) {\n  pathItem.addPath()\n}\nlocal numPoints = pathItem.totalPathPoints(0)\nif (numPoints < values.size) {\n  local lastPointIdx = numPoints - 1\n  local lastPointY = pathItem.getPathPointPos(0, lastPointIdx).y\n\n  for (local i = numPoints; i < values.size; i++) {\n    if (lineType == 'smooth') {\n      pathItem.addBezierPoint(0, lastPointIdx * dx, lastPointY, 0, 0, 0, 0)\n    } else {\n      pathItem.addPoint(0, lastPointIdx * dx, lastPointY)\n    }\n  }\n}\n\nlocal srcPoints = pathItem.getPathPoints(0)\nlocal dstPoints = List()\nvalues.forEach((value, idx) => {\n  dstPoints.add(Point(idx * dx, (yMax - value) * plotHeight / dy))\n})\n\nlocal lastDstPoint = dstPoints.get(dstPoints.size - 1)\nfor (local i = values.size; i < numPoints; i++) {\n  dstPoints.add(lastDstPoint)\n}\n\n// smoothening the points\ndstPoints.forEach((p, idx) => {\n  local p1 = if (idx > 0) { dstPoints.get(idx - 1) } else { p }\n  local p2 = if (idx < dstPoints.size - 1) { dstPoints.get(idx + 1) } else { p }\n  local v = Vector(p2.x, p2.y) - Vector(p1.x, p1.y)\n  v = v.normalized() * dx / 2\n\n  p.x1 = -v.x\n  p.y1 = -v.y\n  p.x2 = v.x\n  p.y2 = v.y\n})\nlog('dstPoints', dstPoints)\n"}, "$-def:changeDataPointLoopScript": "dstPoints.forEach((dstPoint, idx) => {\n  local srcPoint = srcPoints.get(idx)\n  local x = srcPoint.x * (1 - t) + dstPoint.x * t\n  local y = srcPoint.y * (1 - t) + dstPoint.y * t\n  if (lineType == 'smooth') {\n    local x1 = srcPoint.x1 * (1 - t) + dstPoint.x1 * t\n    local y1 = srcPoint.y1 * (1 - t) + dstPoint.y1 * t\n    local x2 = srcPoint.x2 * (1 - t) + dstPoint.x2 * t\n    local y2 = srcPoint.y2 * (1 - t) + dstPoint.y2 * t\n    pathItem.setPathBezierPointPos(0, idx, x, y, x1, y1, x2, y2)\n\n  } else {\n    pathItem.setPathPointPos(0, idx, x, y)\n  }\n})\n", "$-def:changeDataPointEndScript": "if (numPoints > values.size) {\n  for (local i = values.size; i < numPoints; i++) {\n    pathItem.removePathPoint(0, i)\n  }\n}\n\nlog('path points', pathItem.getPathPoints(0))\n", "item": {"id": "root", "name": "Line chart", "shape": "rect", "shapeProps": {"fill": {"type": "solid", "color": "rgba(200,200,200,1)"}, "strokeColor": "rgba(200,200,200,1)", "cornerRadius": {"$-expr": "cornerRadius"}}, "locked": false, "area": {"x": 0, "y": 0, "w": {"$-expr": "width"}, "h": {"$-expr": "height"}}, "functions": [{"id": "func1", "name": "Change data points", "args": [{"id": "arg-index", "name": "name", "value": "Data 1", "type": "string", "description": "The name of a dataset"}, {"id": "arg-data", "name": "data", "value": "1, 2, 4, 5", "type": "string", "description": "New data point values (comma separated)"}], "props": {"initScript": {"$-ref": "changeDataPointInitScript"}, "script": {"$-ref": "changeDataPointLoopScript"}, "endScript": {"$-ref": "changeDataPointEndScript"}, "animated": true, "animationType": "animation", "animationDuration": 0.5, "transition": "ease-out", "inBackground": true}}], "childItems": [{"id": "grid", "shape": "grid", "name": "grid", "clip": false, "area": {"x": 10, "y": 10, "w": {"$-expr": "plotWidth"}, "h": {"$-expr": "plotHeight"}}, "childItems": [{"$-foreach": {"source": "datasets", "it": "dataset"}, "id": {"$-str": "dataset-${dataset.id}"}, "name": {"$-expr": "dataset.name"}, "area": {"x": 0, "y": 0, "w": {"$-expr": "plotWidth"}, "h": {"$-expr": "plotHeight"}}, "shape": "path", "tags": ["dataset-path"], "shapeProps": {"smoothing": {"$-expr": "lineType"}, "strokeColor": {"$-expr": "dataset.color"}, "strokeSize": 2, "strokePattern": "solid", "paths": [{"id": "dataset-path", "closed": false, "pos": "relative", "points": [{"$-foreach": {"source": "parseDatasetPoints(dataset.values)", "it": "point", "index": "pointIdx"}, "$-extend": {"$-expr": "toJSON(point)"}, "id": {"$-expr": "pointIdx"}}]}]}}]}]}, "init": "plotWidth = max(1, width - 20)\nplotHeight = max(1, height - 20)\ndy = yMax - yMin\ndx = plotWidth * xStep / max(0.000001, xMax - xMin)\n\n\nstruct Point {\n    x: 0\n    y: 0\n    t: 'L'\n}\n\nstruct SmoothPoint {\n    x: 0\n    y: 0\n    x1: 0\n    y1: 0\n    x2: 0\n    y2: 0\n    t: 'B'\n}\n\nfunc parseDatasetPoints(encodedPoints) {\n    if (abs(plotHeight / dy) > 100000 || abs(dx) > 10000) {\n        return List()\n    }\n\n    local points = encodedPoints.split(',').map((p, idx) => {\n        local value = parseFloat(p.trim())\n        Point(dx * idx * 100 / plotWidth, (yMax - value) * 100 / dy)\n    })\n\n    if (lineType == 'smooth') {\n        return points.map((p, idx) => {\n            local p1 = if (idx > 0) { points.get(idx - 1) } else { p }\n            local p2 = if (idx < points.size - 1) { points.get(idx + 1) } else { p }\n            local v = Vector(p2.x, p2.y) - Vector(p1.x, p1.y)\n            v = v.normalized() * dx / 2\n\n            local x1 = -v.x * 100 / plotWidth\n            local y1 = -v.y * 100 / plotHeight\n            local x2 = v.x * 100 / plotWidth\n            local y2 = v.y * 100 / plotHeight\n            SmoothPoint(p.x, p.y, x1, y1, x2, y2)\n        })\n    } else {\n        return points\n    }\n}\n\n"}