name: Prototype
args: {
  numPages          : {type: "number", value: 3, min: 1, name: "Numbers of pages"},
  maxCols           : {type: "number", value: 10, min: 1, name: "Max per row"},
  cornerRadius      : {type: "number", value: 20, min: 0, name: "Corner radius"},
  pageMargin        : {type: "number", value: 60, min: 0, name: "Page margin"},
  background        : {type: "advanced-color", value: { type: "solid", color: "rgba(240, 240, 240, 1)" }, name: "Background"},
  strokeColor       : {type: "color", value: "rgba(212,212,212,1.0)", name: "Stroke color"},
  strokeSize        : {type: "number", value: 1, min: 0, name: "Stroke size"},
  transition        : {type: "choice", value: "simple", options: ["simple", "slide"], name: "Page transition"},
  transitionDuration: {type: "number", value: 0.5, min: 0, name: "Transition duration"},
  transitionType    : {type: "choice", value: "ease-out", options: ["linear", "smooth", "ease-in", "ease-out", "ease-in-out", "bounce"], name: "Transition type"}
}

import:
  - ./src/prototype.sch

handlers:
  delete: onDeleteItem(itemId, item)

description: Helps designing a basic app prototype with multiple app pages. Each page has an "Open Page" event that, once triggered, displays that page on top.
preview: data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhodG1sPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmlld0JveD0iLTQgLTQgMjQ4IDM2OCI+PGcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDApIHJvdGF0ZSgwKSIgZGF0YS1zdmctaXRlbS1jb250YWluZXItaWQ9ImE1VmxwYU04QiIgZGF0YS1pdGVtLWlkPSJhNVZscGFNOEIiPiAgPGcgc3R5bGU9Im9wYWNpdHk6IDE7IG1peC1ibGVuZC1tb2RlOiBub3JtYWw7Ij4gPGRlZnMvPiA8ZyBmaWx0ZXI9IiI+IDxnIHN0eWxlPSJvcGFjaXR5OiAxOyI+PGc+PGc+PGc+IDwvZz4gPHBhdGggZD0iTSAyMjAgMzYwICBMIDIwIDM2MCBhIDIwIDIwIDAgMCAxIC0yMCAtMjAgIEwgMCAyMCAgYSAyMCAyMCAwIDAgMSAyMCAtMjAgICBMIDIyMCAwICAgYSAyMCAyMCAwIDAgMSAyMCAyMCAgTCAyNDAgMzQwICAgYSAyMCAyMCAwIDAgMSAtMjAgMjAgWiIgc3Ryb2tlLXdpZHRoPSIycHgiIHN0cm9rZT0icmdiYSgxNjAsIDE2MCwgMTYwLCAxKSIgc3Ryb2tlLWRhc2hhcnJheT0iIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBmaWxsPSJyZ2JhKDIwOCwgMjA4LCAyMDgsIDEpIi8+PC9nPjwvZz48L2c+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsiLz48L2c+ICAgICAgICA8Zz48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDIwLDIwKSI+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsgbWl4LWJsZW5kLW1vZGU6IG5vcm1hbDsiPiA8ZGVmcy8+IDxnIGZpbHRlcj0iIj4gPGcgc3R5bGU9Im9wYWNpdHk6IDE7Ii8+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsiPjxmb3JlaWduT2JqZWN0IGlkPSJpdGVtLXRleHQtc2xvdC16b1h4S1Zqb2YtYm9keSIgeD0iMCIgeT0iMCIgd2lkdGg9IjIwMCIgaGVpZ2h0PSI0MCI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgY2xhc3M9Iml0ZW0tdGV4dC1jb250YWluZXIiIHN0eWxlPSJjb2xvcjogcmdiKDExMSwgMTExLCAxMTEpOyBmb250LXNpemU6IDI5cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7IHBhZGRpbmc6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBkaXNwbGF5OiB0YWJsZS1jZWxsOyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXdlaWdodDogYm9sZDsgd2lkdGg6IDIwMHB4OyBoZWlnaHQ6IDQwcHg7Ij48ZGl2IGNsYXNzPSJpdGVtLXRleHQtZWxlbWVudCIgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsiPjxwIHN0eWxlPSJtYXJnaW4tdG9wOiAwcHg7IG1hcmdpbi1ib3R0b206IDBweDsgcGFkZGluZzogMHB4OyBtaW4taGVpZ2h0OiAxOHB4OyI+QXBwIFByb3RvdHlwZTwvcD48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PC9nPjwvZz4gICAgICAgICA8L2c+PC9nPjxnIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsNDAsMjQwKSI+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsgbWl4LWJsZW5kLW1vZGU6IG5vcm1hbDsiPiA8ZGVmcy8+IDxnIGZpbHRlcj0iIj4gPGcgc3R5bGU9Im9wYWNpdHk6IDE7Ij48Zz48Zz48Zz4gPC9nPiA8cGF0aCBkPSJNIDE0NSA0MCAgTCAxNSA0MCBhIDE1IDE1IDAgMCAxIC0xNSAtMTUgIEwgMCAxNSAgYSAxNSAxNSAwIDAgMSAxNSAtMTUgICBMIDE0NSAwICAgYSAxNSAxNSAwIDAgMSAxNSAxNSAgTCAxNjAgMjUgICBhIDE1IDE1IDAgMCAxIC0xNSAxNSBaIiBzdHJva2Utd2lkdGg9IjJweCIgc3Ryb2tlPSJyZ2JhKDE1NCwgMTU0LCAxNTQsIDEpIiBzdHJva2UtZGFzaGFycmF5PSIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGZpbGw9InJnYmEoMTAzLCAxMDMsIDEwMywgMSkiLz48L2c+PC9nPjwvZz4gIDxnIHN0eWxlPSJvcGFjaXR5OiAxOyI+PGZvcmVpZ25PYmplY3QgaWQ9Iml0ZW0tdGV4dC1zbG90LXhNdXdxWHkycy1ib2R5IiB4PSIwIiB5PSIwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjQwIj48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBjbGFzcz0iaXRlbS10ZXh0LWNvbnRhaW5lciIgc3R5bGU9ImNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7IGZvbnQtc2l6ZTogMjBweDsgZm9udC1mYW1pbHk6IEFyaWFsLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7IHBhZGRpbmc6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBkaXNwbGF5OiB0YWJsZS1jZWxsOyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB3aWR0aDogMTYwcHg7IGhlaWdodDogNDBweDsgZm9udC13ZWlnaHQ6IGJvbGQ7Ij48ZGl2IGNsYXNzPSJpdGVtLXRleHQtZWxlbWVudCIgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsiPjxwIHN0eWxlPSJtYXJnaW4tdG9wOiAwcHg7IG1hcmdpbi1ib3R0b206IDBweDsgcGFkZGluZzogMHB4OyBtaW4taGVpZ2h0OiAxOHB4OyI+T3BlbjwvcD48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PC9nPjwvZz4gICAgICAgICA8L2c+PC9nPjxnIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsNDAuMDAwMDAwMDAwMDAwMTE0LDMwMCkiPiAgPGcgc3R5bGU9Im9wYWNpdHk6IDE7IG1peC1ibGVuZC1tb2RlOiBub3JtYWw7Ij4gPGRlZnMvPiA8ZyBmaWx0ZXI9IiI+IDxnIHN0eWxlPSJvcGFjaXR5OiAxOyI+PGc+PGc+PGc+IDwvZz4gPHBhdGggZD0iTSAxNDUgNDAgIEwgMTUgNDAgYSAxNSAxNSAwIDAgMSAtMTUgLTE1ICBMIDAgMTUgIGEgMTUgMTUgMCAwIDEgMTUgLTE1ICAgTCAxNDUgMCAgIGEgMTUgMTUgMCAwIDEgMTUgMTUgIEwgMTYwIDI1ICAgYSAxNSAxNSAwIDAgMSAtMTUgMTUgWiIgc3Ryb2tlLXdpZHRoPSIycHgiIHN0cm9rZT0icmdiYSgxNTQsIDE1NCwgMTU0LCAxKSIgc3Ryb2tlLWRhc2hhcnJheT0iIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBmaWxsPSJyZ2JhKDEwMywgMTAzLCAxMDMsIDEpIi8+PC9nPjwvZz48L2c+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsiPjxmb3JlaWduT2JqZWN0IGlkPSJpdGVtLXRleHQtc2xvdC1rUlI5UE83dGUtYm9keSIgeD0iMCIgeT0iMCIgd2lkdGg9IjE2MCIgaGVpZ2h0PSI0MCI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgY2xhc3M9Iml0ZW0tdGV4dC1jb250YWluZXIiIHN0eWxlPSJjb2xvcjogcmdiKDI1NSwgMjU1LCAyNTUpOyBmb250LXNpemU6IDIwcHg7IGZvbnQtZmFtaWx5OiBBcmlhbCwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmOyBwYWRkaW5nOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsgdmVydGljYWwtYWxpZ246IG1pZGRsZTsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgZGlzcGxheTogdGFibGUtY2VsbDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgd2lkdGg6IDE2MHB4OyBoZWlnaHQ6IDQwcHg7IGZvbnQtd2VpZ2h0OiBib2xkOyI+PGRpdiBjbGFzcz0iaXRlbS10ZXh0LWVsZW1lbnQiIHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7Ij48cCBzdHlsZT0ibWFyZ2luLXRvcDogMHB4OyBtYXJnaW4tYm90dG9tOiAwcHg7IHBhZGRpbmc6IDBweDsgbWluLWhlaWdodDogMThweDsiPkJhY2s8L3A+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0PjwvZz48L2c+ICAgICAgICAgPC9nPjwvZz48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDQwLDgwKSI+ICA8ZyBzdHlsZT0ib3BhY2l0eTogMTsgbWl4LWJsZW5kLW1vZGU6IG5vcm1hbDsiPiA8ZGVmcy8+IDxnIGZpbHRlcj0iIj4gPGcgc3R5bGU9Im9wYWNpdHk6IDE7Ij48Zz48Zz48Zz4gPC9nPiA8cGF0aCBkPSJNIDE0MCAxMjAgIEwgMjAgMTIwIGEgMjAgMjAgMCAwIDEgLTIwIC0yMCAgTCAwIDIwICBhIDIwIDIwIDAgMCAxIDIwIC0yMCAgIEwgMTQwIDAgICBhIDIwIDIwIDAgMCAxIDIwIDIwICBMIDE2MCAxMDAgICBhIDIwIDIwIDAgMCAxIC0yMCAyMCBaIiBzdHJva2Utd2lkdGg9IjJweCIgc3Ryb2tlPSJyZ2JhKDE2MCwgMTYwLCAxNjAsIDEpIiBzdHJva2UtZGFzaGFycmF5PSIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGZpbGw9InJnYmEoMjI3LCAyMjQsIDIyNCwgMSkiLz48L2c+PC9nPjwvZz4gIDxnIHN0eWxlPSJvcGFjaXR5OiAxOyIvPjwvZz4gICAgICAgICA8L2c+PC9nPjwvZz4gPC9nPjwvZz48L3N2Zz4=
controls:
  - name: addPage
    type: button
    text: Add page
    x: {$-expr: "(numPages % maxCols) * (width + pageMargin) + width + 10" }
    y: {$-expr: "floor(numPages / maxCols) * (height + pageMargin)" }
    width: 120
    height: 30
    click:
      - numPages += 1

  - $-for: { start: 0, until: {$-expr: numPages }, it: idx }
    $-if: numPages > 1
    data:
      pageIndex: { $-expr: idx }
    selectedItemId: { $-str: "page-${idx+1}" }
    name: removeSlide
    type: button
    text: "â¤«"
    placement: BL
    x: {$-expr: "((idx+1) % maxCols) * (width + pageMargin) + width"}
    y: {$-expr: "floor((idx+1) / maxCols) * (height + pageMargin)"}
    width: 20
    height: 20
    click:
      - deletePage(control.data.pageIndex)

  - $-for: { start: 1, until: {$-expr: "numPages + 1"}, it: idx}
    name: duplicatePage
    text: Duplicate page
    type: button
    data:
      pageIndex: {$-expr: idx}
    selectedItemId: {$-str: "page-${idx}"}
    x: {$-expr: "(idx % maxCols) * (width + pageMargin) + width/2 - 60"}
    y: {$-expr: "floor(idx / maxCols) * (height + pageMargin) + height + 5"}
    width: 120
    height: 30
    click:
      - duplicatePage(control.data.pageIndex)

item:
  id: root
  name: Slides
  shape: rect
  area:
    x: 0
    "y": 0
    w: {$-expr: width}
    h: {$-expr: height}
    r: 0
    px: 0.5
    py: 0.5
    sx: 1
    sy: 1
  shapeProps:
    cornerRadius: {$-expr: cornerRadius}
    fill:
      type: none
    strokeColor: {$-expr: strokeColor}
    strokeSize: {$-expr: strokeSize}
    strokePattern: solid
  behavior:
    events:
      - id: init
        event: init
        actions:
          - $-for: {start: 2, until: {$-expr: "numPages + 1"}, it: idx}
            id: {$-str: "hide-page-${idx}"}
            element: {$-str: "#page-${idx}"}
            method: hide
            args:
              animated: false

          - $-for: {start: 1, until: {$-expr: "numPages + 1"}, it: idx}
            id: {$-str: "hide-title-${idx}"}
            element: {$-str: "#page-title-${idx}"}
            method: hide
            args:
              animated: false

          - id: "set-var-current"
            element: self
            method: script
            args:
              script: setVar('currentPage', 1)

          - id: set-clip
            element: self
            method: set
            args:
              field: clip
              value: true
              animated: false

          - id: identify-connectors
            element: self
            method: script
            args:
              script: |
                findChildItemsByTag('prototype-page').forEach(page => {
                    Connections.findConnectionsWith(page).forEach(otherItem => {
                        Connections.findConnections(page, otherItem).forEach(connector => {
                            connector.hide()
                        })
                        otherItem.assignEvent('clicked', () => {
                            page.sendEvent('Open Page')
                        })
                    })
                })
  textSlots:
    body:
      text: |
        <p>This is a root of the page. <b>Do not use it</b>. Instead add items to other pages.</p>
        <p>Each page has "<b>Open page</b>" event, which, when triggered,
        displays the page on top of the root item</p>
      color: rgba(170, 170, 170, 1)

  childItems:
    - $-for: {start: 1, until: {$-expr: "numPages + 1"}, it: idx}
      id: {$-str: "page-${idx}"}
      name: {$-str: "Page ${idx}"}
      args:
        templateIgnoredProps:
          - name
      shape: rect
      tags:
        - $-str: page-${idx}
        - prototype-page
      area:
        x: {$-expr: "(idx % maxCols) * (width + pageMargin)"}
        y: {$-expr: "floor(idx / maxCols) * (height + pageMargin)"}
        w: {$-expr: width}
        h: {$-expr: height}
        r: 0
        px: 0.5
        py: 0.5
        sx: 1
        sy: 1
      shapeProps:
        cornerRadius: {$-expr: cornerRadius}
        fill: {$-expr: background}
        strokeColor: {$-expr: strokeColor}
        strokeSize: {$-expr: strokeSize}
        strokePattern: solid
      behavior:
        events:
          - id: init
            event: init
            actions:
              - id: set-corner-radius
                element: self
                method: set
                args:
                  field: shapeProps.cornerRadius
                  value: 0
              - id: set-stroke-size
                element: self
                method: set
                args:
                  field: shapeProps.strokeSize
                  value: 0

              - $-if: idx != 1
                id: hide-self
                element: self
                method: hide
                args:
                  animated: false

              - id: move-to-root
                element: self
                method: moveToItem
                args:
                  destinationItem: '#root'
                  matchPoint: top-left
                  animated: false

          - id: open-page
            event: Open Page
            actions:
              - id: 'condition'
                element: '#root'
                method: condition
                args:
                  expression: {$-str: "getVar('currentPage') == ${idx}"}
                  fail: pass
                  success: break-event

              - $-if: transition == 'slide'
                id: "root-slide-script"
                element: '#root'
                method: script
                args:
                  initScript:
                    $-str: |
                      currentPage = getVar('currentPage')
                      nextPage = ${idx}
                      currentPageItem = findChildItemsByTag('page-' + currentPage).get(0)
                      nextPageItem = findChildItemsByTag('page-' + ${idx}).get(0)
                      setVar('currentPage', nextPage)
                      currentDstX = -getWidth()
                      currentSrcX = 0
                      nextSrcX = getWidth()
                      nextDstX = 0
                      if (nextPage < currentPage) {
                          currentDstX = getWidth()
                          nextSrcX = -getWidth()
                      }
                      if (currentPageItem && nextPageItem) {
                          nextPageItem.setPosX(nextSrcX)
                          nextPageItem.show()
                      }
                  script:
                    $-str: |
                      if (currentPageItem && nextPageItem) {
                          nextPageItem.setPosX(nextSrcX * (1 - t) + nextDstX * t)
                          currentPageItem.setPosX(currentSrcX * (1 - t) + currentDstX * t)
                      }
                  animated: true
                  animationType: animation
                  animationDuration: {$-expr: transitionDuration}
                  transition: {$-expr: transitionType}

              - $-else: ""
                id: root-simple-script
                element: '#root'
                method: script
                args:
                  script:
                    $-str: |
                      currentPage = getVar('currentPage')
                      findChildItemsByTag('page-' + currentPage).forEach((page) => {
                          page.hide()
                      })
                      findChildItemsByTag('page-' + ${idx}).forEach((page) => {
                          page.show()
                      })
                      setVar('currentPage', ${idx})
      textSlots: {}

    - $-for: {start: 1, until: {$-expr: "numPages + 1"}, it: idx}
      id: {$-str: "page-title-${idx}"}
      name: {$-str: "Page ${idx}"}
      shape: none
      area:
        x: {$-expr: "(idx % maxCols) * (width + pageMargin)" }
        y: {$-expr: "floor(idx / maxCols) * (height + pageMargin) - 30"}
        w: {$-expr: width}
        h: 30
        r: 0
        px: 0.5
        py: 0.5
        sx: 1
        sy: 1
      shapeProps: {}
      textSlots:
        body:
          text: {$-str: "Page ${idx}"}
  opacity: 100
  selfOpacity: 100
  visible: true
  clip: false